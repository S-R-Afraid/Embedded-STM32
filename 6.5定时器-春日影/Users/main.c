//#include "./stm32f1xx_it.h"
#include "./SYSTEM/sys/sys.h"
#include "./SYSTEM/usart/usart.h"
#include "./SYSTEM/delay/delay.h"
#include "./BSP/LED/led.h"
//#include "./BSP/BEEP/beep.h"
//#include "./BSP/EXTI/exti.h"
#include "./BSP/KEY/key.h"    //如果运行IWDG该行取消注释
//#include "./BSP/WDG/wdg.h"
#include "./BSP/TIMER/btim.h"
#include "./BSP/TIMER/gtim.h"
#include "./BSP/PLAY_BEEP/BEEPSOUND.h"


int Haruhikage[]={//春日影,来自于https://www.bilibili.com/opus/835589443680206849
    10,10,10,10,9,9,8,8,8,8,9,9,
    10,10,10,11,11,10,9,9,9,9,9,0,
    10,10,10,10,9,9,8,8,8,8,9,9,
    10,10,10,11,11,10,9,9,9,9,9,0,
    /*------------------------*/
    10,10,10,10,9,9,8,8,8,8,9,9,
    10,10,10,11,11,10,9,9,9,9,9,0,
    10,10,10,10,9,9,8,8,8,8,9,9,
    10,10,10,11,11,10,9,9,9,9,1,2,
    /*------------------------*/
    3,3,3,3,2,2,4,4,3,3,2,2,
    2,2,2,2,1,1,4,4,3,3,2,2,
    2,2,2,2,1,2,3,3,3,3,3,0,
    /*------------------------*/
    0,0,0,0,0,0,3,3,5,5,8,8,
    7,7,7,7,8,8,7,7,7,7,8,8,
    7,6,5,5,5,5,5,5,2,2,4,4,
    4,4,4,4,3,3,3,3,3,3,-5,-5,
    4,4,3,3,2,2,3,3,3,3,5,5,
    /*------------------------*/
    1,1,1,1,1,0,0,0,0,0,1,1,
    2,2,1,1,1,0,1,1,5,5,1,1,
    4,4,4,4,3,3,2,2,2,2,1,1,
    1,1,1,1,1,0,0,0,0,0,1,2,
    /*------------------------*/
    3,3,3,3,2,2,4,4,3,3,2,2,
    2,2,2,2,1,1,4,4,3,3,2,2,
    2,2,2,2,1,2,3,3,3,3,3,0,
    /*------------------------*/
    0,0,0,0,0,0,3,3,5,5,8,8,
    7,7,7,7,8,8,7,7,7,7,8,8,
    7,6,5,5,5,5,5,5,2,2,4,4,
    4,4,4,4,3,3,3,3,3,3,-5,-5,
    4,4,3,3,2,2,3,3,3,3,5,5,
    /*------------------------*/
    1,1,1,1,1,0,0,0,0,0,1,1,
    2,2,1,1,1,1,1,1,5,5,1,1,
    4,4,4,4,3,2,2,2,2,2,1,1,
    1,1,1,1,1,0,0,0,0,0,0,0,
    /*------------------------*/
    13,13,12,12,12,12,12,12,11,11,11,11,
    10,10,9,9,9,9,9,9,0,0,5,5,
    5,5,4,4,4,4,4,4,3,3,2,2,
    2,2,2,2,1,-7,1,1,1,0,0,0,0,0,
    /*------------------------*/
    13,13,12,12,12,12,12,12,11,11,11,11,
    10,10,9,9,9,9,9,9,0,0,3,3,
    3,3,3,3,3,3,3,3,2,2,3,3,
    9,9,9,9,8,8,8,8,0,0,8,8,
    /*------------------------*/
    7,7,7,7,6,6,6,6,6,6,6,6,
    0,0,0,0,6,6,6,6,5,5,4,4,
    4,4,4,4,4,4,3,4,5,5,5,5,
    5,5,5,5,5,5,0,0,0,0,0,0,
    /*------------------------*/
    3,2,3,2,3,4,5,5,0,0,4,5,
    6,6,0,0,6,7,8,8,0,0,9,8,
    5,5,5,5,0,1,5,5,4,4,4,4,
    3,3,3,3,3,4,5,5,5,5,0,0,
    /*------------------------*/
    3,2,3,2,3,4,5,5,0,0,4,5,
    6,6,0,0,5,6,7,7,0,0,0,0,3,
    10,10,10,10,0,3,11,11,10,10,9,9,
    9,9,9,9,8,7,8,8,0,0,5,8,
    /*------------------------*/
    9,9,9,9,8,8,8,8,0,0,5,5,
    9,9,9,9,8,8,8,8,0,0,5,8,
    9,9,9,9,8,8,8,8,0,0,5,8,
    9,9,9,9,10,9,9,8,8,0,0,8,8,
    /*------------------------*/
    7,7,7,7,6,6,6,6,0,0,5,5,
    5,5,5,5,4,4,4,4,3,3,2,2,
    3,3,3,3,3,3,0,0,0,0,0,0,
    3,3,4,4,3,3,4,4,3,3,2,2,
    1,1,1,1,1,1,1,1,1,1,1,1,
    /*------------------------*/
    /*还有第二页，但我不想写了*/
    -20,
};

int main(void)
{
    HAL_Init();
    sys_stm32_clock_init(RCC_PLL_MUL9);
    delay_init(72);
    usart_init(115200);
    led_init();
    key_init();
    //gtim_tim2_int_init(5000 - 1, 7200 - 1); /* 10Khz的计数频率，计数5K次为500ms，绿灯闪烁 */
    play_beep_sound_init(232,Haruhikage);
    printf("main\r\n");
    
    //btim_tim6_int_init(464*10, 7200-1);     //10Khz 的计数频率
    //gtim_timx_pwm_chy_init(38-1, 7200 - 1);/* 10Khz的计数频率,263.15hz的PWM.接近C4 */
    /*修改比较值为0，即音量为0*/
    //__HAL_TIM_SET_COMPARE(&g_timx_pwm_chy_handle, GTIM_TIMX_PWM_CHY, 0);
    
    while (1)
    {
        delay_ms(153);
        play_next();
        LED1_TOGGLE();
        //__HAL_TIM_SET_COMPARE(&g_timx_pwm_chy_handle, GTIM_TIMX_PWM_CHY, 0);
    }
    

    
}





